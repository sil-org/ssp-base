# Run the integration tests before running metadata tests on the various
# containers so that integration tests interact with those containers when they
# only have production dependencies installed, not dev. dependencies.
- name: test
  service: app
  command: /data/run-tests.sh

- name: check-hub-metadata-for-tests
  service: ssp-hub.local
  command: /data/run-metadata-tests.sh

- name: check-idp-metadata-for-tests
  service: ssp-idp1.local
  command: /data/run-metadata-tests.sh

- name: check-sp-metadata-for-tests
  service: ssp-sp1.local
  command: /data/run-metadata-tests.sh

- name: push
  service: app
  type: push
  image_name: silintl/ssp-base
  image_tag: "{{.Branch}}"
  exclude: main
  registry: https://index.docker.io/v1/
  encrypted_dockercfg_path: dockercfg.encrypted

- name: push_latest
  service: app
  type: push
  image_name: silintl/ssp-base
  image_tag: "latest"
  tag: main
  registry: https://index.docker.io/v1/
  encrypted_dockercfg_path: dockercfg.encrypted
